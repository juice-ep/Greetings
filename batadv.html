<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battery Pack Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .problem-section, .calculator-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border: 2px solid #e9ecef;
        }

        .section-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .equations {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }

        .equation {
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            margin: 8px 0;
            color: #2c3e50;
        }

        .variables {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .variable {
            display: grid;
            grid-template-columns: 60px 1fr;
            gap: 10px;
            margin: 8px 0;
            align-items: center;
        }

        .variable-name {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #e74c3c;
        }

        .problem-display {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #27ae60;
        }

        .problem-title {
            font-size: 1.2em;
            color: #27ae60;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .given-values {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .given-value {
            background: #ecf0f1;
            padding: 8px 12px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            text-align: center;
        }

        .find-section {
            background: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }

        .input-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #bdc3c7;
            border-radius: 5px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #3498db;
        }

        .input-disabled {
            background-color: #f8f9fa !important;
            color: #6c757d !important;
            cursor: not-allowed !important;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-secondary {
            background: #27ae60;
            color: white;
        }

        .btn-secondary:hover {
            background: #229954;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }

        .results {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border: 2px solid #95a5a6;
        }

        .result-item {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            margin: 8px 0;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .result-correct {
            border-left: 4px solid #27ae60;
            background: #d4edda;
        }

        .result-incorrect {
            border-left: 4px solid #e74c3c;
            background: #f8d7da;
        }

        .result-given {
            border-left: 4px solid #6c757d;
            background: #e9ecef;
        }

        .status-icon {
            font-size: 1.2em;
        }

        .score {
            text-align: center;
            font-size: 1.1em;
            margin-top: 15px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 5px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .given-values {
                grid-template-columns: 1fr;
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Battery Pack Calculator</h1>
            <p>Practice solving battery pack configuration problems with random variables</p>
        </div>

        <div class="main-content">
            <div class="problem-section">
                <h2 class="section-title">📚 Reference & Problem</h2>
                
                <div class="equations">
                    <h3>Equations:</h3>
                    <div class="equation">n<sub>s</sub> = v<sub>p</sub> / v<sub>c</sub></div>
                    <div class="equation">n<sub>p</sub> = Ah<sub>p</sub> / Ah<sub>c</sub></div>
                    <div class="equation">n<sub>t</sub> = n<sub>p</sub> × n<sub>s</sub></div>
                    <div class="equation">w<sub>p</sub> = w<sub>1</sub> × n<sub>t</sub></div>
                    <div class="equation">e<sub>p</sub> = v<sub>p</sub> × Ah<sub>p</sub></div>
                    <div class="equation">C<sub>r</sub> = I<sub>cc</sub> / Ah<sub>c</sub> (cell C rate)</div>
                    <div class="equation">C<sub>r</sub> = I<sub>cp</sub> / Ah<sub>p</sub> (pack C rate)</div>
                    <div class="equation">P<sub>cr</sub> = v × I<sub>cp</sub></div>
                    <div class="equation">t = E<sub>p</sub> / P<sub>cr</sub> (charging time)</div>
                </div>

                <div class="variables">
                    <h3>Variables:</h3>
                    <div class="variable">
                        <span class="variable-name">n<sub>s</sub></span>
                        <span>Number of cells in series</span>
                    </div>
                    <div class="variable">
                        <span class="variable-name">n<sub>p</sub></span>
                        <span>Number of cells in parallel</span>
                    </div>
                    <div class="variable">
                        <span class="variable-name">n<sub>t</sub></span>
                        <span>Total number of cells in battery pack</span>
                    </div>
                    <div class="variable">
                        <span class="variable-name">v<sub>p</sub></span>
                        <span>Pack voltage (V)</span>
                    </div>
                    <div class="variable">
                        <span class="variable-name">v<sub>c</sub></span>
                        <span>Cell voltage (V)</span>
                    </div>
                    <div class="variable">
                        <span class="variable-name">Ah<sub>p</sub></span>
                        <span>Pack capacity (Ah)</span>
                    </div>
                    <div class="variable">
                        <span class="variable-name">Ah<sub>c</sub></span>
                        <span>Cell capacity (Ah)</span>
                    </div>
                    <div class="variable">
                        <span class="variable-name">w<sub>p</sub></span>
                        <span>Weight of cells in pack (kg)</span>
                    </div>
                    <div class="variable">
                        <span class="variable-name">w<sub>1</sub></span>
                        <span>Weight of 1 cell (kg)</span>
                    </div>
                    <div class="variable">
                        <span class="variable-name">E<sub>p</sub></span>
                        <span>Energy of pack (Wh)</span>
                    </div>
                    <div class="variable">
                        <span class="variable-name">C<sub>r</sub></span>
                        <span>C rate (charging/discharging rate)</span>
                    </div>
                    <div class="variable">
                        <span class="variable-name">I<sub>cc</sub></span>
                        <span>Current at C rate for cell (A)</span>
                    </div>
                    <div class="variable">
                        <span class="variable-name">I<sub>cp</sub></span>
                        <span>Current at C rate for pack (A)</span>
                    </div>
                    <div class="variable">
                        <span class="variable-name">P<sub>cr</sub></span>
                        <span>Power at C rate (W)</span>
                    </div>
                    <div class="variable">
                        <span class="variable-name">t</span>
                        <span>Charging time (hours)</span>
                    </div>
                </div>

                <div class="problem-display" id="problemDisplay">
                    <div class="problem-title">Current Problem:</div>
                    <p>Click "Generate New Problem" to start!</p>
                </div>
            </div>

            <div class="calculator-section">
                <h2 class="section-title">🧮 Calculator</h2>
                
                <div class="input-group">
                    <label for="ns">Number of cells in series (n<sub>s</sub>):</label>
                    <input type="number" id="ns" step="1" min="1">
                </div>

                <div class="input-group">
                    <label for="np">Number of cells in parallel (n<sub>p</sub>):</label>
                    <input type="number" id="np" step="1" min="1">
                </div>

                <div class="input-group">
                    <label for="nt">Total number of cells (n<sub>t</sub>):</label>
                    <input type="number" id="nt" step="1" min="1">
                </div>

                <div class="input-group">
                    <label for="vp">Pack voltage (v<sub>p</sub>) [V]:</label>
                    <input type="number" id="vp" step="0.01" min="0">
                </div>

                <div class="input-group">
                    <label for="vc">Cell voltage (v<sub>c</sub>) [V]:</label>
                    <input type="number" id="vc" step="0.01" min="0">
                </div>

                <div class="input-group">
                    <label for="ahp">Pack capacity (Ah<sub>p</sub>) [Ah]:</label>
                    <input type="number" id="ahp" step="0.01" min="0">
                </div>

                <div class="input-group">
                    <label for="ahc">Cell capacity (Ah<sub>c</sub>) [Ah]:</label>
                    <input type="number" id="ahc" step="0.01" min="0">
                </div>

                <div class="input-group">
                    <label for="wp">Weight of cells in pack (w<sub>p</sub>) [kg]:</label>
                    <input type="number" id="wp" step="0.01" min="0">
                </div>

                <div class="input-group">
                    <label for="w1">Weight of 1 cell (w<sub>1</sub>) [kg]:</label>
                    <input type="number" id="w1" step="0.001" min="0">
                </div>

                <div class="input-group">
                    <label for="ep">Energy of pack (E<sub>p</sub>) [Wh]:</label>
                    <input type="number" id="ep" step="0.01" min="0">
                </div>

                <div class="input-group">
                    <label for="cr">C rate (C<sub>r</sub>):</label>
                    <input type="number" id="cr" step="0.01" min="0">
                </div>

                <div class="input-group">
                    <label for="icc">Current at C rate for cell (I<sub>cc</sub>) [A]:</label>
                    <input type="number" id="icc" step="0.01" min="0">
                </div>

                <div class="input-group">
                    <label for="icp">Current at C rate for pack (I<sub>cp</sub>) [A]:</label>
                    <input type="number" id="icp" step="0.01" min="0">
                </div>

                <div class="input-group">
                    <label for="pcr">Power at C rate (P<sub>cr</sub>) [W]:</label>
                    <input type="number" id="pcr" step="0.01" min="0">
                </div>

                <div class="input-group">
                    <label for="t">Charging time (t) [hours]:</label>
                    <input type="number" id="t" step="0.01" min="0">
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="generateProblem()">Generate New Problem</button>
                    <button class="btn btn-secondary" onclick="checkAnswers()">Check Answers</button>
                </div>

                <div class="results" id="results" style="display: none;">
                    <h3>Results:</h3>
                    <div id="resultsList"></div>
                    <div class="score" id="scoreDisplay"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentProblem = null;

        // Variable display names and units for better presentation
        const variableInfo = {
            ns: { name: 'n<sub>s</sub>', unit: '', description: 'cells in series' },
            np: { name: 'n<sub>p</sub>', unit: '', description: 'cells in parallel' },
            nt: { name: 'n<sub>t</sub>', unit: '', description: 'total cells' },
            vp: { name: 'v<sub>p</sub>', unit: 'V', description: 'pack voltage' },
            vc: { name: 'v<sub>c</sub>', unit: 'V', description: 'cell voltage' },
            ahp: { name: 'Ah<sub>p</sub>', unit: 'Ah', description: 'pack capacity' },
            ahc: { name: 'Ah<sub>c</sub>', unit: 'Ah', description: 'cell capacity' },
            wp: { name: 'w<sub>p</sub>', unit: 'kg', description: 'pack weight' },
            w1: { name: 'w<sub>1</sub>', unit: 'kg', description: 'cell weight' },
            ep: { name: 'E<sub>p</sub>', unit: 'Wh', description: 'pack energy' },
            cr: { name: 'C<sub>r</sub>', unit: '', description: 'C rate' },
            icc: { name: 'I<sub>cc</sub>', unit: 'A', description: 'cell current at C rate' },
            icp: { name: 'I<sub>cp</sub>', unit: 'A', description: 'pack current at C rate' },
            pcr: { name: 'P<sub>cr</sub>', unit: 'W', description: 'power at C rate' },
            t: { name: 't', unit: 'hours', description: 'charging time' }
        };

        function generateProblem() {
            try {
                // Start with fundamental values that make sense
                const ns = Math.floor(Math.random() * 9) + 2; // 2-10 cells in series
                const np = Math.floor(Math.random() * 7) + 2; // 2-8 cells in parallel
                const vc = Math.round((Math.random() * 2 + 3) * 100) / 100; // 3-5V cell voltage
                const ahc = Math.round((Math.random() * 4 + 1) * 100) / 100; // 1-5Ah cell capacity
                const w1 = Math.round((Math.random() * 0.4 + 0.1) * 1000) / 1000; // 0.1-0.5kg per cell
                const cr = Math.round((Math.random() * 2 + 0.5) * 100) / 100; // 0.5-2.5 C rate
                
                // Calculate all derived values
                const vp = Math.round(ns * vc * 100) / 100;
                const ahp = Math.round(np * ahc * 100) / 100;
                const nt = np * ns;
                const wp = Math.round(w1 * nt * 1000) / 1000;
                const ep = Math.round(vp * ahp * 100) / 100;
                const icc = Math.round(cr * ahc * 100) / 100; // Cell current at C rate
                const icp = Math.round(cr * ahp * 100) / 100; // Pack current at C rate  
                const pcr = Math.round(vp * icp * 100) / 100; // Power at C rate using pack current
                const t = Math.round((ep / pcr) * 100) / 100; // Charging time
                
                const allValues = {
                    ns: ns,
                    np: np,
                    nt: nt,
                    vp: vp,
                    vc: vc,
                    ahp: ahp,
                    ahc: ahc,
                    wp: wp,
                    w1: w1,
                    ep: ep,
                    cr: cr,
                    icc: icc,
                    icp: icp,
                    pcr: pcr,
                    t: t
                };

                // Define different problem types with different combinations of given variables
                // With 15 total variables, we need 8-10 given values to make problems solvable
const problemTypes = [
                    // Basic configuration problems - focus on pack design
                    ['vp', 'vc', 'ahp', 'ahc', 'w1', 'cr', 'ep', 'icc'],
                    ['ns', 'np', 'vc', 'ahc', 'w1', 'cr', 'vp', 'pcr'],
                    ['ns', 'vp', 'np', 'ahp', 'w1', 'icp', 'nt', 'ep'],
                    
                    // Power and charging focused problems
                    ['vc', 'ahc', 'ns', 'np', 'cr', 'w1', 'vp', 'ahp'],
                    ['vp', 'ahp', 'icp', 'w1', 'nt', 'cr', 'ns', 'vc'],
                    ['ep', 'pcr', 'vc', 'ahc', 'ns', 'np', 'w1', 'cr'],
                    ['t', 'pcr', 'vc', 'ahc', 'ns', 'cr', 'w1', 'vp'],
                    
                    // Cell vs Pack current problems
                    ['cr', 'ahc', 'ahp', 'vc', 'ns', 'np', 'w1', 'ep'],
                    ['icc', 'icp', 'vp', 'vc', 'ns', 'w1', 'ep', 'cr'],
                    ['ns', 'np', 'cr', 'ahc', 'vp', 'icc', 'w1', 'pcr'],
                    
                    // Mixed complexity problems
                    ['nt', 'vc', 'ahc', 'ep', 'w1', 'cr', 'icp', 'pcr'],
                    ['ns', 'ahc', 'wp', 'ep', 'cr', 'pcr', 'vc', 'icp'],
                    ['np', 'vc', 'vp', 'ahc', 'wp', 't', 'cr', 'ep'],
                    
                    // Advanced calculation problems
                    ['ep', 'nt', 'vc', 'ahc', 'cr', 'pcr', 'w1', 'ns'],
                    ['wp', 'vp', 'ahc', 'np', 'icp', 't', 'ep', 'vc'],
                    ['cr', 'pcr', 'vc', 'ns', 'ahc', 'wp', 't', 'np'],
                    ['t', 'icc', 'np', 'ns', 'vc', 'ep', 'w1', 'ahc']
                ];

                // Randomly select a problem type
                const selectedType = problemTypes[Math.floor(Math.random() * problemTypes.length)];
                
                // Use 8-10 given values to ensure problems are solvable
                const numGiven = Math.min(Math.max(selectedType.length, 8), 10);
                const givenVars = selectedType.slice(0, numGiven);
                
                // Create the problem
                const given = {};
                const toFind = [];
                
                Object.keys(allValues).forEach(key => {
                    if (givenVars.includes(key)) {
                        given[key] = allValues[key];
                    } else {
                        toFind.push(key);
                    }
                });

                currentProblem = {
                    given: given,
                    toFind: toFind,
                    solution: allValues
                };
                
                console.log('Generated problem:', currentProblem);
                
                displayProblem();
                setupInputs();
                hideResults();
            } catch (error) {
                console.error('Error generating problem:', error);
                // Fallback to a simple problem
                currentProblem = {
                    given: { vp: 12.0, vc: 3.0, ahp: 10.0, ahc: 2.5, w1: 0.2 },
                    toFind: ['ns', 'np', 'nt', 'wp', 'ep', 'cr', 'icc', 'icp', 'pcr', 't'],
                    solution: { 
                        ns: 4, np: 4, nt: 16, vp: 12.0, vc: 3.0, ahp: 10.0, ahc: 2.5, 
                        wp: 3.2, w1: 0.2, ep: 120.0, cr: 1.0, icc: 2.5, icp: 10.0, pcr: 120.0, t: 1.0 
                    }
                };
                displayProblem();
                setupInputs();
                hideResults();
            }
        }

        function displayProblem() {
            try {
                if (!currentProblem || !currentProblem.given) {
                    console.error('No current problem to display');
                    return;
                }
                
                const { given, toFind } = currentProblem;
                const problemDisplay = document.getElementById('problemDisplay');
                
                if (!problemDisplay) {
                    console.error('Problem display element not found');
                    return;
                }
                
                // Create given values display
                const givenValuesHtml = Object.keys(given).map(key => {
                    const info = variableInfo[key];
                    const value = given[key];
                    const displayValue = Number.isInteger(value) ? value.toString() : value.toFixed(3).replace(/\.?0+$/, '');
                    return `<div class="given-value">${info.name} = ${displayValue} ${info.unit}</div>`;
                }).join('');
                
                // Create find section
                const findVarsHtml = toFind.map(key => variableInfo[key].name).join(', ');
                
                problemDisplay.innerHTML = `
                    <div class="problem-title">Solve for the unknown values:</div>
                    <div class="given-values">
                        ${givenValuesHtml}
                    </div>
                    <div class="find-section">
                        <strong>Find:</strong> ${findVarsHtml}
                    </div>
                `;
                
                // Add animation
                problemDisplay.classList.remove('fade-in');
                problemDisplay.offsetHeight; // Force reflow
                problemDisplay.classList.add('fade-in');
                
                console.log('Problem displayed successfully');
            } catch (error) {
                console.error('Error displaying problem:', error);
                const problemDisplay = document.getElementById('problemDisplay');
                if (problemDisplay) {
                    problemDisplay.innerHTML = `
                        <div class="problem-title">Error generating problem</div>
                        <p>Please try clicking "Generate New Problem" again.</p>
                    `;
                }
            }
        }

        function setupInputs() {
            if (!currentProblem) return;
            
            const { given, toFind } = currentProblem;
            
            // Reset all inputs and enable them
            Object.keys(variableInfo).forEach(key => {
                const input = document.getElementById(key);
                if (input) {
                    input.value = '';
                    input.disabled = false;
                    input.classList.remove('input-disabled');
                }
            });
            
            // Fill in and disable given values
            Object.keys(given).forEach(key => {
                const input = document.getElementById(key);
                if (input) {
                    const value = given[key];
                    input.value = Number.isInteger(value) ? value.toString() : value.toFixed(3).replace(/\.?0+$/, '');
                    input.disabled = true;
                    input.classList.add('input-disabled');
                }
            });
        }

        function hideResults() {
            document.getElementById('results').style.display = 'none';
        }

        function checkAnswers() {
            if (!currentProblem) {
                alert('Please generate a problem first!');
                return;
            }

            const { given, toFind, solution } = currentProblem;
            const tolerance = 0.01; // 1% tolerance for floating point comparisons
            
            const results = [];
            let correct = 0;
            let totalToCheck = 0;
            
            // Check all variables
            Object.keys(variableInfo).forEach(key => {
                const input = document.getElementById(key);
                const userValue = parseFloat(input.value);
                const correctValue = solution[key];
                const isGiven = given.hasOwnProperty(key);
                
                if (isGiven) {
                    // This was a given value
                    results.push({
                        variable: key,
                        userAnswer: userValue,
                        correctAnswer: correctValue,
                        isGiven: true,
                        isCorrect: null
                    });
                } else {
                    // This needs to be solved
                    totalToCheck++;
                    const isCorrect = !isNaN(userValue) && Math.abs(userValue - correctValue) <= Math.abs(correctValue * tolerance);
                    
                    if (isCorrect) correct++;
                    
                    results.push({
                        variable: key,
                        userAnswer: userValue,
                        correctAnswer: correctValue,
                        isGiven: false,
                        isCorrect: isCorrect
                    });
                }
            });

            displayResults(results, correct, totalToCheck);
        }

        function displayResults(results, correct, total) {
            const resultsList = document.getElementById('resultsList');
            const scoreDisplay = document.getElementById('scoreDisplay');
            
            resultsList.innerHTML = results.map(result => {
                const info = variableInfo[result.variable];
                const userAnswer = isNaN(result.userAnswer) ? 'Not answered' : 
                    (Number.isInteger(result.userAnswer) ? result.userAnswer.toString() : result.userAnswer.toFixed(3).replace(/\.?0+$/, ''));
                const correctAnswer = Number.isInteger(result.correctAnswer) ? result.correctAnswer.toString() : 
                    result.correctAnswer.toFixed(3).replace(/\.?0+$/, '');
                
                let className = 'result-item ';
                let statusIcon = '';
                
                if (result.isGiven) {
                    className += 'result-given';
                    statusIcon = '📋';
                } else if (result.isCorrect) {
                    className += 'result-correct';
                    statusIcon = '✅';
                } else {
                    className += 'result-incorrect';
                    statusIcon = '❌';
                }
                
                return `
                    <div class="${className}">
                        <div>
                            <strong>${info.name}:</strong> 
                            ${result.isGiven ? 'Given' : `Your answer: ${userAnswer}`}
                            | Correct: ${correctAnswer} ${info.unit}
                        </div>
                        <div class="status-icon">${statusIcon}</div>
                    </div>
                `;
            }).join('');
            
            const percentage = total > 0 ? Math.round((correct / total) * 100) : 0;
            scoreDisplay.innerHTML = `
                <strong>Score: ${correct}/${total} (${percentage}%)</strong>
                ${percentage === 100 ? ' 🎉 Perfect!' : percentage >= 80 ? ' 👍 Great job!' : ' 📚 Keep practicing!'}
            `;
            
            document.getElementById('results').style.display = 'block';
            document.getElementById('results').classList.add('fade-in');
        }

        // Generate initial problem when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, generating initial problem');
            generateProblem();
        });
        
        window.addEventListener('load', function() {
            console.log('Window loaded');
            if (!currentProblem) {
                console.log('No problem exists, generating one');
                generateProblem();
            }
        });
        
        // Fallback timer
        setTimeout(function() {
            if (!currentProblem) {
                console.log('Fallback timer triggered, generating problem');
                generateProblem();
            }
        }, 1000);
    </script>
</body>
</html>
